(function(){function a(){}var c="http://hoatle-dev.appspot.com/gadgets/stream-mixer/",b=20;a.getBaseUrl=function(){return c};a.setBaseUrl=function(a){a&&a!==c&&(c=a)};a.getNumberOfActivitiesEachFetch=function(){return b};a.setNumberOfActivitiesEachFetch=function(a){isNaN(a)||(b=a)};a.portalEnvironment={portalName:null,host:null,restContextName:null};this.Configuration=a})();
(function(){function a(){}a.getLang=function(){return(new gadgets.Prefs).getLang()};a.getCountry=function(){return(new gadgets.Prefs).getCountry()};a.getMsg=function(a,b){if(a){var d=(new gadgets.Prefs).getMsg(a);if(d==="")return debug.warn("Can not find resource bundle with key = "+a),d;if(!b)return d;var f=d.match(/{\d+}/g);if(f==null)return debug.warn("no argument found to be substituted with: "+b),d;f.length!==b.length&&debug.warn("required "+f.length+" args, provided: "+b.length);for(var i=0,
e=f.length;i<e;i++){var g=f[i].match(/\d+/g)[0];b[g]?d=d.replace(f[i],b[g]):debug.warn("matches["+i+"]: "+f[i]+" but no opt_args["+g+"]")}return d}else debug.warn("key is null!")};this.Locale=a})();
(function(){function a(){}a.getPrettyTime=function(a){var b=function(a){for(var b=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],c=["january","february","march","april","may","june","july","august","september","october","november","december"],e=0,g=b.length;e<g;e++)b[e]=Locale.getMsg(b[e]);e=0;for(g=c.length;e<g;e++)c[e]=Locale.getMsg(c[e]);var e=a.getMonth(),g=a.getFullYear(),j=a.getDay(),k=a.getDate(),l="",h=a.getHours(),l=h<12?Locale.getMsg("am"):Locale.getMsg("pm");h===
0&&(h=12);h>12&&(h-=12);a=a.getMinutes();a+="";a.length===1&&(a="0"+a);return Locale.getMsg("day_date_month_year_at_hour_min_ap",[b[j],k,c[e],g,h,a,l])};if(isNaN(a))return Locale.getMsg("an_undetermined_amount_of_time_ago");time=((new Date).getTime()-a.getTime())/1E3;return time<30?Locale.getMsg("just_now"):time<60?Locale.getMsg("less_than_a_minute_ago"):time<120?Locale.getMsg("about_a_minute_ago"):time<3600?Locale.getMsg("about_0_minutes_ago",[Math.round(time/60)]):time<7200?Locale.getMsg("about_an_hour_ago"):
time<86400?Locale.getMsg("about_0_hours_ago",[Math.round(time/3600)]):""+b(a)};a.sortActivities=function(a){a.sort(function(a,c){return c.postedTime-a.postedTime})};a.getActivities=function(a,b){a||(a={});if(!b||!jQuery.isFunction(b))log.error("callback is not specified or not a function!");else{var d=a.first||0,f=a.max||Configuration.getNumberOfActivitiesEachFetch(),i=a.userId||opensocial.IdSpec.PersonId.VIEWER,e=a.groupId||opensocial.IdSpec.GroupId.SELF,g=a.key||"activities",j=opensocial.newDataRequest(),
k={};k[opensocial.DataRequest.ActivityRequestFields.FIRST]=d;k[opensocial.DataRequest.ActivityRequestFields.MAX]=f;d=opensocial.newIdSpec({userId:i,groupId:e});j.add(j.newFetchActivitiesRequest(d,k),g);j.send(b)}};a.getViewer=function(a,b){var d=opensocial.newDataRequest();d.add(d.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER,a),"viewer");d.send(b)};a.getViewerFriends=function(a,b){var d=opensocial.newDataRequest(),f=opensocial.newIdSpec({userId:"VIEWER",groupId:"FRIENDS"});d.add(d.newFetchPeopleRequest(f,
a),"viewerFriends");d.send(b)};a.addActivity=function(a){var b=$("#Activitytemplate").clone();b.attr("id","Activity");$("#avatarIcon",b).attr("src",a.avatarUrl);$("#activityIcon",b).attr("src",a.appIcon);$("#displayName",b).html(a.displayName);$("#content",b).html(a.content);$("#postedDay",b).html(a.prettyTime);$("#Activities").append(b);b.show()};a.renderActivity=function(c){$.each(c,function(b,c){a.addActivity(c)})};this.Util=a})();
(function(){function a(){}var c={};a.Type={TWITTER:"twitter"};a.addAccount=function(a,d){c[a]=d};a.getAccount=function(a){return c[a]};a.authenticate=function(){};a.isAuthenticated=function(){};a.canDisplayAddAccountForm=function(){return!1};this.AccountManager=a})();
(function(){function a(c){this.init(c);a.prototype.getType=function(){return this.type};a.prototype.setType=function(a){this.type=a};a.prototype.getContent=function(){return this.content};a.prototype.setContent=function(a){this.content=a};a.prototype.getDisplayName=function(){return this.displayName};a.prototype.setDisplayName=function(a){this.displayName=a};a.prototype.getProfileUrl=function(){return this.profileUrl};a.prototype.setProfileUrl=function(a){this.profileUrl=a};a.prototype.getAvatarUrl=
function(){return this.avatarUrl};a.prototype.setAvatarUrl=function(a){this.avatarUrl=a};a.prototype.getPostedTime=function(){return this.postedTime};a.prototype.setPostedTime=function(a){this.postedTime=a};a.prototype.getPrettyTime=function(){return this.prettyTime};a.prototype.setPrettyTime=function(a){this.prettyTime=a};a.prototype.getAppIcon=function(){return this.appIcon};a.prototype.setAppIcon=function(a){this.appIcon=a}}a.Type={TWITTER:"twitter",EXO_PLATFORM:"exo",FACEBOOK:"facebook",LINKEDIN:"linkedin"};
a.prototype.init=function(a){this.type=a.type;this.content=a.content;this.displayName=a.displayName;this.profileUrl=a.profileUrl;this.avatarUrl=a.avatarUrl;this.postedTime=a.postedTime;this.prettyTime=Util.getPrettyTime(new Date(a.postedTime));this.appIcon=Configuration.getBaseUrl()+"style/images/"+a.type+".png"};this.Activity=a})();
(function(){function a(a){this.init(a)}a.prototype.init=function(a){this.textBoxId=a.componentIds.textBoxId;this.shareButtonId=a.componentIds.shareButtonId;this.twitterCheckBoxId=a.componentIds.twitterCheckBoxId;this.onSuccessCallback=a.callback.onSuccess;this.onFailCallback=a.callback.onFail};this.ActivityComposer=a})(jQuery);
(function(a){function c(){debug.debug("ActivityStream#initProfiles()");var a={};a[opensocial.DataRequest.PeopleRequestFields.PROFILE_DETAILS]=[opensocial.Person.Field.ID,opensocial.Person.Field.NAME,opensocial.Person.Field.PROFILE_URL,opensocial.Person.Field.THUMBNAIL_URL,"portalName","restContext","host"];Util.getViewer(a,function(a){a.hadError()?(debug.error("Failed to get viewer"),debug.info(a)):(e=a.get("viewer").getData(),Configuration.portalEnvironment={portalName:e.getField("portalName"),restContextName:e.getField("restContextName"),
host:e.getField("hostName")},debug.info("Configuration.portalEnvironment:"),debug.debug(Configuration.portalEnvironment),a={},a[opensocial.DataRequest.PeopleRequestFields.FIRST]=0,a[opensocial.DataRequest.PeopleRequestFields.MAX]=100,a[opensocial.DataRequest.PeopleRequestFields.PROFILE_DETAILS]=[opensocial.Person.Field.ID,opensocial.Person.Field.NAME,opensocial.Person.Field.PROFILE_URL,opensocial.Person.Field.THUMBNAIL_URL],Util.getViewerFriends(a,function(a){a.hadError()?(debug.error("Failed to get viewer friends"),
debug.info(a)):(g=a.get("viewerFriends").getData(),debug.info("viewerFriends:"),debug.debug(g),d())}))})}function b(){}function d(){debug.debug("ActivityStream#initActivities()");Util.getActivities({},function(b){if(b.hadError())debug.warn("Failed to init viewer activities"),debug.info(b);else{var c=b.get("activities").getData();c.each(function(a){var b=e.getField(opensocial.Person.Field.THUMBNAIL_URL);b||(b=Configuration.portalEnvironment.host+"/social-resources/skin/ShareImages/activity/AvatarPeople.gif",
debug.info("default avatarUrl: "+b));b=a.getField(opensocial.Activity.Field.TITLE).replace(/&#60;/g,"<").replace(/&#62;/g,">").replace(/&#34;/g,'"');a={type:Activity.Type.EXO_PLATFORM,content:unescape(b),displayName:e.getDisplayName(),profileUrl:e.getField(opensocial.Person.Field.PROFILE_URL),avatarUrl:e.getField(opensocial.Person.Field.THUMBNAIL_URL),postedTime:a.getField(opensocial.Activity.Field.POSTED_TIME)};debug.info("osViewerActivities:");debug.debug(c);a=new Activity(a);j.push(a)});debug.info("viewerActivities:");
debug.debug(j);a.merge(h,j);debug.info("exoActivities:");debug.debug(h);Util.getActivities({groupId:opensocial.IdSpec.GroupId.FRIENDS},function(b){if(b.hadError())debug.warn("Failed to init viewer's friends activities"),debug.info(b);else{var c=b.get("activities").getData();c.each(function(a){var b;b=a.getField(opensocial.Activity.Field.USER_ID);b=g.getById(b);var d=b.getField(opensocial.Person.Field.THUMBNAIL_URL);d||(d=Configuration.portalEnvironment.host+"/social-resources/skin/ShareImages/activity/AvatarPeople.gif",
debug.info("default avatarUrl: "+d));debug.info("postedUser:");debug.debug(b);d=a.getField(opensocial.Activity.Field.TITLE).replace(/&#60;/g,"<").replace(/&#62;/g,">").replace(/&#34;/g,'"');a={type:Activity.Type.EXO_PLATFORM,content:unescape(d),displayName:b.getDisplayName(),profileUrl:b.getField(opensocial.Person.Field.PROFILE_URL),avatarUrl:b.getField(opensocial.Person.Field.THUMBNAIL_URL),postedTime:a.getField(opensocial.Activity.Field.POSTED_TIME)};debug.info("osViewerFriendsActivities:");debug.debug(c);
a=new Activity(a);k.push(a)});a.merge(h,k);debug.info("final exoActivities:");debug.debug(h);i()}})}})}var f,i,e,g=[],j=[],k=[],l=[],h=[],m=[];b.Type={UNIFIED:"unified",EXO_PLATFORM:"exo",TWITTER:"twitter",FACEBOOK:"facebook",LINKEDIN:"linkedin",CONNECTIONS:"connections",ME:"me"};b.configure=function(a){debug.debug("ActiivtyStream#configure");a||(a={});f=a.selectedType||b.Type.UNIFIED;i=a.onSuccess;c()};b.getSelectedType=function(){return f};b.setSelectedType=function(a){f=a};b.getActivities=function(){debug.debug("getActivities: "+
f);if(f===b.Type.UNIFIED)return l=[],a.merge(l,h),a.merge(l,m),Util.sortActivities(l),l;else if(f===b.Type.EXO_PLATFORM)return Util.sortActivities(h),h;else if(f===b.Type.TWITTER)return m;else if(f===b.Type.CONNECTIONS)return Util.sortActivities(k),k;else if(f===b.Type.ME)return Util.sortActivities(j),j;return[]};b.hasNewer=function(){return!1};b.onNewerHandler=function(){};b.hasOlder=function(){return!1};b.getOlder=function(){};b.getNewer=function(){};this.ActivityStream=b})(jQuery);
(function(a){a(document).ready(function(){a("#ActivityContent").show();ActivityStream.configure({selectedType:ActivityStream.Type.EXO_PLATFORM,onSuccess:function(){debug.info("onSuccess with activities:");debug.info(ActivityStream.getActivities());Util.renderActivity(ActivityStream.getActivities())},onFail:function(a){debug.error(a)}});new ActivityComposer({componentIds:{textBoxId:"statusTxt",shareButtonId:"UpdateStatusButton",twitterCheckBoxId:"postToTwitter"},callback:{onSuccess:function(){},onSuccess:function(){}}});
a.each(AccountManager.Type,function(c,b){AccountManager.canDisplayAddAccountForm(b)&&(a("#LoginForm > #socialLogo").attr("src","style/images/"+b+"_big.jpeg"),a("#LoginForm > #socialLogo").attr("title","value"),a("#ActivityContent").hide(),a("#LoginForm").show())});a("#postToTwitter").change(function(){if(a(this).attr("checked")&&(AccountManager.getAccount("twitter")==void 0||!AccountManager.isAuthenticated("twitter")))a(this).attr("checked",!1),a("#LoginForm > #socialLogo").attr("src","style/images/twitter_big.jpeg"),
a("#LoginForm > #socialLogo").attr("title","twitter"),a("#LoginForm").show(),a("#ActivityContent").hide()});a("#LoginForm input[type=button]").click(function(){var c=a(this).parent(),b=a("img",c).attr("title"),d=a("#userName",c).val();a("#userName",c).val("");var f=a("#passWord",c).val();a("#passWord",c).val("");AccountManager.addAccount(b,{username:d,password:f});AccountManager.authenticate(AccountManager.Type.TWITTER,{onSuccess:function(){a("#LoginForm").hide();a("#ActivityContent").show()},onFail:function(){a("#dialog").dialog();
a("#LoginForm").hide();a("#ActivityContent").show()}});gadgets.window.adjustHeight()})})})(jQuery);